<!DOCTYPE html>
<html>
<head>
  <title>Hartslagmeter</title>
</head>
<body>
  <div id="console"></div>
  <button class="switch">Toggle Flash</button>

  <script>
    const consoleOutput = document.getElementById("console");
    const log = function (msg) {
      consoleOutput.innerText = `${consoleOutput.innerText}\n${msg}`;
      console.log(msg);
    }

    const SUPPORTS_MEDIA_DEVICES = 'mediaDevices' in navigator;

    if (SUPPORTS_MEDIA_DEVICES) {
      navigator.mediaDevices.enumerateDevices().then(devices => {
        const cameras = devices.filter((device) => device.kind === 'videoinput');

        if (cameras.length === 0) {
          log('No camera found on this device.');
        }

        navigator.mediaDevices.getUserMedia({
          video: {
            facingMode: 'environment',
          }
        }).then(stream => {
          const track = stream.getVideoTracks()[0];
          const imageCapture = new ImageCapture(track)

          imageCapture.getPhotoCapabilities().then(capabilities => {
            const btn = document.querySelector('.switch');
            const torchSupported = !!capabilities.torch || (
              'fillLightMode' in capabilities &&
              capabilities.fillLightMode.length != 0 &&
              capabilities.fillLightMode != 'none'
            );

            if (torchSupported) {
              let torch = false;
              btn.addEventListener('click', function (e) {
                try {
                  track.applyConstraints({
                    advanced: [{
                      torch: (torch = !torch)
                    }]
                  });
                } catch (err) {
                  log(err);
                }
              });
            } else {
              log("No torch found");
            }
          }).catch(log);
        }).catch(log);
      }).catch(log);
    }
  </script>
</body>
</html>
